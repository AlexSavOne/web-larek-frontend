# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения (MVP)

## Общее описание

Каждая цепочка действий в проекте подчиняется принципу MVP (Model-View-Presenter). Взаимодействие пользователя с приложением инициирует цепочку событий V → P → M → P → V.

Просмотр товаров (V → P): Пользователь нажимает на товар, что инициирует событие в Presenter.
Выбор товара (P → M): Presenter обращается к Model, чтобы получить данные о выбранном товаре.
Отображение модального окна товара (M → P → V): Model возвращает данные товара, Presenter обрабатывает эти данные и указывает View отобразить информацию в модальном окне.
Добавление товара в корзину (V → P → M): Пользователь нажимает на кнопку добавления в корзину, Presenter сообщает Model о добавлении товара.
Обновление корзины (M → P → V): Model обновляет состояние корзины и через Presenter это состояние отображается в View.
Оформление заказа (V → P → M): Пользователь вводит свои данные и подтверждает заказ, Presenter передает эти данные в Model.
Подтверждение заказа (M → P → V): Model обрабатывает заказ и возвращает результат в Presenter, который затем указывает View отобразить сообщение об успешном оформлении заказа.

### Model (Модель) - класс, который работает с данными, проводит вычисления и руководит всеми бизнес-процессами.

**`Model<T>`**: Абстрактный класс базовой модели для управления данными.

- Отвечает за базовую структуру и функциональность моделей в приложении.
- Используемые интерфейсы: `IEvents`.
- Конструктор:
  - `constructor(data: Partial<T>, events: IEvents)`: Принимает частичные данные модели и объект событий для уведомления об изменениях.
- Методы:
  - `emitChanges(event: string, payload?: object)`: Сообщает всем подписчикам об изменении модели, передавая опциональные данные.

**`AppState`**: Класс модели для управления состоянием приложения.

- Отвечает за управление данными корзины, каталога товаров и другими функциональными данными приложения.
- Используемые интерфейсы: `IAppState`, `IOrder`, `IOrderForm`, `IProduct`, `FormErrors`.
- Унаследован от класса `Model<IAppState>`.
- Свойства:
  - `basket: Map<string, number>`: Корзина товаров с количеством каждого товара.
  - `catalog: IProduct[]`: Каталог товаров.
  - `loading: boolean`: Флаг, указывающий на состояние загрузки данных.
  - `order: IOrder`: Информация о заказе.
  - `preview: string | null`: Идентификатор товара, выбранного для предпросмотра.
  - `formErrors: FormErrors`: Ошибки формы заказа.
- Методы:
  - `toggleOrderedItem(id: string, isIncluded: boolean)`: Переключает выбор товара в заказе.
  - `clearBasket()`: Очищает корзину товаров.
  - `getTotal()`: Вычисляет общую стоимость товаров в корзине.
  - `setCatalog(products: IProduct[])`: Устанавливает каталог товаров.
  - `setPreview(item: IProduct)`: Устанавливает товар для предпросмотра.
  - `setOrderField(field: keyof IOrderForm, value: string)`: Устанавливает значение поля формы заказа.
  - `validateOrder()`: Проверяет данные формы заказа на валидность и обновляет ошибки.

**`Api`**: Класс предоставляет интерфейс для выполнения HTTP запросов к серверу.

- Он абстрагирует детали работы с сетью, позволяя разделить логику работы с сетью от логики компонентов отображения. Это соблюдает принцип разделения ответственности (Separation of Concerns).
- Используемые интерфейсы: `IEvents`.
- Конструктор:
  - `constructor(baseUrl: string, options?: RequestInit)`: Создает новый экземпляр класса Api с указанным базовым URL и опциями запроса.
- Методы:
  - `get(uri: string): Promise<any>`: Выполняет GET запрос к указанному URI.
  - `post(uri: string, data: object, method?: ApiPostMethods): Promise<any>`: Выполняет POST запрос к указанному URI с переданными данными.
- Структура данных:
  - `ApiListResponse<Type>`: Описывает ответ от сервера с коллекцией данных, содержащий общее количество элементов и сами элементы.

**`ShopAPI`**: Класс-наследник расширяет функциональность базового класса `Api`.

- Предоставляет методы для работы с API магазина.
- Используемые интерфейсы: `IEvents`.
- Конструктор:
  - `constructor(baseUrl: string, options?: RequestInit)`: Создает новый экземпляр класса `ShopAPI` с указанным базовым URL и опциями запроса.
- Методы:
  - `getCart(): Promise<Map<string, number>>`: Получает содержимое корзины товаров.
  - `addToCart(item: ICartItem): Promise<void>`: Добавляет товар в корзину.
  - `removeFromCart(itemId: string): Promise<void>`: Удаляет товар из корзины по его идентификатору.
  - `getCatalog(): Promise<IProduct[]>`: Получает каталог товаров.
  - `getOrderInfo(): Promise<IOrder>`: Получает информацию о заказе.
- Структура данных:
  - `ICartItem[]`: Массив элементов корзины, содержащий информацию о каждом товаре.
  - `IProduct[]`: Массив элементов каталога, содержащий информацию о каждом товаре.
  - `IOrder`: Интерфейс, описывающий информацию о заказе.

### View (Вид или представление) - классы, показывающие пользователю интерфейс и данные из модели на экране.

**`Component`**: является базовым абстрактным классом для всех компонентов представления.

- Предоставляет основные методы и свойства, необходимые для работы с компонентами интерфейса.
- Используемые интерфейсы: `IComponent`
- Конструктор: `constructor(options: IComponentOptions)`
- Методы:
  - `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает класс элемента.
  - `setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое элемента.
  - `setDisabled(element: HTMLElement, state: boolean)`: Устанавливает или убирает атрибут `disabled` у элемента в зависимости от состояния.
  - `setHidden(element: HTMLElement)`: Скрывает элемент.
  - `setVisible(element: HTMLElement)`: Показывает элемент.
  - `setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает изображение элементу с альтернативным текстом, если он предоставлен.
  - `render(data?: Partial<T>): HTMLElement`: Отрисовывает компонент, принимая в качестве аргумента данные для обновления.

**`Modal`**: Класс для создания модальных окон.

- Используемые интерфейсы: `IModalData`
- Конструктор: `constructor(container: HTMLElement, events: IEvents)`
  - `container`: Корневой элемент, в котором будет отображаться модальное окно.
  - `events`: Экземпляр класса `EventEmitter` для обработки событий.
- Методы:
  - `content`: Устанавливает содержимое модального окна.
  - `open()`: Открытие модального окна.
  - `close()`: Закрытие модального окна.
  - `render(data: IModalData): HTMLElement`: Отрисовывает модальное окно с указанным содержимым.

**`Basket`**: Класс для отображения корзины.

- Используемые интерфейсы: `IBasketView`
- Конструктор: `constructor(container: HTMLElement, events: EventEmitter)`
  - `container`: Корневой элемент, в котором будет отображаться компонент корзины.
  - `events`: Экземпляр класса `EventEmitter` для обработки событий.
- Методы:
  - `items`: Устанавливает элементы корзины.
  - `selected`: Устанавливает выбранные элементы корзины.
  - `total`: Устанавливает общую стоимость корзины.

**`Form`**: Класс для создания форм.

- Используемые интерфейсы: `IFormState`
- Конструктор: `constructor(protected container: HTMLFormElement, protected events: IEvents)`
  - `container`: Корневой элемент формы.
  - `events`: Экземпляр класса `EventEmitter` для обработки событий.
- Методы:
  - `onInputChange(field: keyof T, value: string)`: Обработчик изменения значения в поле формы.
  - `render(state: Partial<T> & IFormState)`: Отображает текущее состояние формы.

**`Success`**: Класс для отображения сообщений об успешном выполнении действий.

- Используемые интерфейсы: `ISuccess`
- Конструктор: `constructor(options: ISuccessOptions)`
  - `options`: Объект с параметрами настройки сообщения об успешном выполнении.

#### Специализированные классы представления

**`Page`**: Класс для отображения страниц.

- Используемые интерфейсы: `IPage`
- Конструктор: `constructor(container: HTMLElement, events: IEvents)`
- Свойства:
  - `_counter`: Элемент счетчика корзины.
  - `_catalog`: Элемент каталога товаров.
  - `_wrapper`: Обертка страницы.
  - `_basket`: Элемент корзины.
- Методы:
  - `set counter(value: number)`: Устанавливает значение счетчика корзины.
  - `set catalog(items: HTMLElement[])`: Устанавливает элементы каталога товаров.
  - `set locked(value: boolean)`: Блокирует или разблокирует страницу в зависимости от значения `value`.

**`Card`**: Класс для отображения карточек товаров.

- Используемые интерфейсы: `ICard`
- Конструктор: `constructor(container: HTMLElement, actions?: ICardActions)`
- Свойства:
  - `_title`: Заголовок карточки товара.
  - `_image`: Изображение карточки товара.
  - `_description`: Описание карточки товара.
  - `_button`: Кнопка карточки товара.
- Методы:
  - `set id(value: string)`: Устанавливает идентификатор карточки товара.
  - `get id(): string`: Получает идентификатор карточки товара.
  - `set title(value: string)`: Устанавливает заголовок карточки товара.
  - `get title(): string`: Получает заголовок карточки товара.
  - `set image(value: string)`: Устанавливает изображение карточки товара.
  - `set description(value: string | string[])`: Устанавливает описание карточки товара.

**`Contacts`**: Класс для отображения контактной информации.

- Используемые интерфейсы: `IContacts`
- Конструктор: `constructor(options: IContactsOptions)`
- Методы:
  - `display()`: Отображение контактной информации.

**`Order`**: Класс для управления процессом оформления заказа.

- Используемые интерфейсы: `IOrder`
- Конструктор: `constructor(container: HTMLFormElement, events: IEvents)`
- Методы:
  - `phone`: Устанавливает значение телефона в форме заказа.
  - `email`: Устанавливает значение электронной почты в форме заказа.
  - `processOrder()`: Обрабатывает информацию о заказе.

### Presenter (Представитель) - класс, который обеспечивает связь, является посредником между моделью и видом.

**`EventEmitter`**: Класс, обеспечивает работу событий.

- Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.
- Используемые интерфейсы: `IEvents`
- Конструктор:
  - `constructor()`: Создает экземпляр класса `EventEmitter` с пустым списком событий.
- Методы:
  - `on(event: EventName, callback: (data: T) => void): void`: Устанавливает обработчик на событие с указанным именем.
  - `off(event: EventName, callback: Subscriber): void`: Снимает обработчик с события.
  - `emit(event: string, data?: T): void`: Инициирует событие с указанным именем и данными.
  - `trigger(event: string, context?: Partial<T>): (data: T) => void`: Создает триггер, который при вызове генерирует событие с указанным именем и контекстом.
  - `onAll(callback: (event: EmitterEvent) => void): void`: Подписывает обработчик на все события.
  - `offAll(): void`: Снимает все обработчики событий.

- События:
- `card:select`: Выбор карточки товара.
- `preview:change`: Изменение предпросмотра товара.
- `basket:add`: Добавление товара в корзину.
- `order:submit`: Оформление заказа.
- `form:submitted`: Отправка формы.

### Процессы в приложении

1. **Выбор товара из каталога:**

   - Пользователь кликает по карточке товара в галерее, инициируя событие в компоненте `Card`.
   - Обработчик события клика в компоненте `Card` вызывает метод `emit` посредника (`EventEmitter`), передавая данные о выбранном товаре событию `card:select`.
   - Обработчик события `card:select` в модели (`AppState`) получает данные о выбранном товаре, вызывая метод `setPreview`.
   - Метод `setPreview` модели возвращает данные о товаре, и посредник вызывает событие `preview:change`.
   - Обработчик события `preview:change` в компоненте `Modal` отрисовывает модальное окно товара с переданными данными.

2. **Добавление товара в корзину:**

   - Пользователь кликает на кнопку добавления товара в корзину на модальном окне товара, инициируя событие в компоненте `Modal`.
   - Обработчик события клика в компоненте `Modal` вызывает метод `emit` посредника, передавая данные о добавляемом товаре событию `basket:add`.
   - Обработчик события `basket:add` в модели (`AppState`) обновляет состояние корзины, добавляя выбранный товар.
   - Обновленное состояние корзины передается посредником компоненту `Basket` для обновления интерфейса.

3. **Оформление заказа:**

   - Пользователь вводит свои данные в форму заказа, инициируя событие в компоненте `Order`.
   - Обработчик события ввода данных в компоненте `Order` вызывает методы для установки значений полей формы в модели.
   - После заполнения формы пользователь подтверждает заказ, инициируя событие отправки формы.
   - Обработчик события отправки формы в компоненте `Order` вызывает метод `processOrder` модели для обработки информации о заказе.
   - Модель отправляет данные о заказе на сервер через API.

4. **Подтверждение заказа:**

   - После успешной обработки заказа на сервере, модель получает ответ.
   - В случае успешного оформления заказа, модель передает информацию о статусе заказа посреднику.
   - Обработчик посредника вызывает метод компонента `Success` для отображения сообщения об успешном оформлении заказа на экране.
